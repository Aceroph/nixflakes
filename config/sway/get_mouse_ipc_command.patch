From 6171591a84768ca95057f5a84dfaa9feb5bc45fb Mon Sep 17 00:00:00 2001
From: Aceroph <aos92@proton.me>
Date: Sat, 2 Aug 2025 13:13:30 -0400
Subject: [PATCH] Add GET_MOUSE IPC command

---
 include/ipc.h     |  1 +
 sway/ipc-server.c | 16 ++++++++++++++++
 swaymsg/main.c    |  2 ++
 3 files changed, 19 insertions(+)

diff --git a/include/ipc.h b/include/ipc.h
index ff011750..c38250c7 100644
--- a/include/ipc.h
+++ b/include/ipc.h
@@ -22,6 +22,7 @@ enum ipc_command_type {
 	// sway-specific command types
 	IPC_GET_INPUTS = 100,
 	IPC_GET_SEATS = 101,
+	IPC_GET_MOUSE = 102,
 
 	// Events sent from sway to clients. Events have the highest bits set.
 	IPC_EVENT_WORKSPACE = ((1<<31) | 0),
diff --git a/sway/ipc-server.c b/sway/ipc-server.c
index b934bb56..b329018d 100644
--- a/sway/ipc-server.c
+++ b/sway/ipc-server.c
@@ -14,6 +14,7 @@
 #include <sys/un.h>
 #include <unistd.h>
 #include <wayland-server-core.h>
+#include <wlr/types/wlr_cursor.h>
 #include "sway/commands.h"
 #include "sway/config.h"
 #include "sway/desktop/transaction.h"
@@ -21,6 +22,7 @@
 #include "sway/ipc-server.h"
 #include "sway/output.h"
 #include "sway/server.h"
+#include "sway/input/cursor.h"
 #include "sway/input/input-manager.h"
 #include "sway/input/keyboard.h"
 #include "sway/input/seat.h"
@@ -811,6 +813,20 @@ void ipc_client_handle_command(struct ipc_client *client, uint32_t payload_lengt
 		goto exit_cleanup;
 	}
 
+	case IPC_GET_MOUSE:
+	{
+		json_object *mouse = json_object_new_object();
+		struct sway_seat *seat = input_manager_get_default_seat();
+		json_object *pos_x = json_object_new_double(seat->cursor->cursor->x);
+		json_object *pos_y = json_object_new_double(seat->cursor->cursor->y);
+		json_object_object_add(mouse, "x", pos_x);
+		json_object_object_add(mouse, "y", pos_y);
+		const char *json_string = json_object_to_json_string(mouse);
+		ipc_send_reply(client, payload_type, json_string, (uint32_t)strlen(json_string));
+		json_object_put(mouse);
+		goto exit_cleanup;
+	}
+
 	case IPC_GET_TREE:
 	{
 		json_object *tree = ipc_json_describe_node_recursive(&root->node);
diff --git a/swaymsg/main.c b/swaymsg/main.c
index 361b59ba..11351d0b 100644
--- a/swaymsg/main.c
+++ b/swaymsg/main.c
@@ -540,6 +540,8 @@ int main(int argc, char **argv) {
 		type = IPC_SEND_TICK;
 	} else if (strcasecmp(cmdtype, "subscribe") == 0) {
 		type = IPC_SUBSCRIBE;
+	} else if (strcasecmp(cmdtype, "get_mouse") == 0) {
+		type = IPC_GET_MOUSE;
 	} else {
 		if (quiet) {
 			exit(EXIT_FAILURE);
-- 
2.49.0

